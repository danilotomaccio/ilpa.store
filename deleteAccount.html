<!DOCTYPE html>
<html lang="it">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cancellazione Dati Account</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style>
        /* Stile aggiuntivo per centrare il contenuto verticalmente se necessario */
        body {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            font-family: 'Inter', sans-serif;
        }

        .main-content {
            flex-grow: 1;
        }
    </style>
</head>

<body class="bg-gray-100 text-gray-800">

    <main class="main-content container mx-auto p-6 flex items-center justify-center">
        <div class="bg-white p-8 md:p-10 rounded-lg shadow-xl w-full max-w-md">
            <div class="text-center mb-8">
                <svg width="462" height="978" viewBox="0 0 462 978" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path fill-rule="evenodd" clip-rule="evenodd"
                        d="M437 348L404 430L307.5 500L227 541.5L138.5 500L50 413.5L27.5 348C27.5 348 38.4023 334.791 55.0334 319C76.8795 298.258 108.61 273.062 138.5 267.5C181.426 259.513 206.36 290.408 232.052 322.244C235.179 326.118 238.317 330.006 241.5 333.84C262.884 359.597 286.302 382.896 322 383C368.944 383.137 437 348 437 348Z"
                        fill="#951515" />
                    <path
                        d="M322 383C368.944 383.137 437 348 437 348C437 348 389.87 323.89 357 319C312.019 312.309 241.5 333.84 241.5 333.84C262.884 359.597 286.302 382.896 322 383Z"
                        fill="#660C0C" />
                    <path d="M27.5 348C27.5 348 38.4023 334.791 55.0334 319L27.5 267.5V348Z" fill="#660C0C" />
                    <path
                        d="M119.082 0.0907288C56.07 146.439 28.6656 269.761 44.2906 347.168C51.8996 384.863 69.8099 415.74 100.047 441.139C129.885 466.203 174 496 230.886 501.875C290.758 496 331.888 466.203 361.726 441.139C391.963 415.74 409.873 384.863 417.482 347.168C433.107 269.761 405.703 146.439 342.691 0.0907288H119.082Z"
                        fill="#F3F4F4" fill-opacity="0.15" />
                    <path fill-rule="evenodd" clip-rule="evenodd"
                        d="M230.886 978H419.913C424.351 978 427.949 974.402 427.949 969.964C427.949 963.15 422.832 957.422 416.06 956.656L313.138 945.023C277.746 941.023 251 911.084 251 875.466V613.733C251 568.879 281.576 530.963 322.301 512.166C347.398 500.583 369.103 487.182 387.454 471.767C424.739 440.448 447.319 401.512 456.691 355.082C475.029 264.239 442.357 146.242 379.43 0.0907288L342.691 0.0907288C405.703 146.439 433.107 269.761 417.482 347.168C409.873 384.863 391.963 415.74 361.726 441.139C331.888 466.203 290.758 496 230.886 501.875V978Z"
                        fill="#E6EDEF" />
                    <path
                        d="M148.635 945.023L45.7128 956.656C38.9413 957.422 33.8241 963.15 33.8241 969.964C33.8241 974.402 37.4218 978 41.8598 978H230.886V501.875C174 496 129.885 466.203 100.047 441.139C69.8099 415.74 51.8996 384.863 44.2906 347.168C28.6656 269.761 56.07 146.439 119.082 0.0907288L82.3428 0.0907288C19.4156 146.242 -13.2557 264.239 5.08147 355.082C14.4536 401.512 37.0339 440.448 74.3189 471.767C92.6698 487.182 114.375 500.583 139.472 512.166C180.197 530.963 210.773 568.879 210.773 613.733V875.466C210.773 911.084 184.027 941.023 148.635 945.023Z"
                        fill="white" />
                </svg>

                <h2 class="text-3xl font-bold text-gray-700">Cancellazione Dati Account</h2>
                <p class="text-gray-600 mt-2">Inserisci l'indirizzo email associato al tuo account Vint per richiedere
                    la
                    cancellazione definitiva dei tuoi dati personali.</p>
            </div>

            <form id="deleteAccountForm" class="space-y-6">
                <div>
                    <label for="email" class="block text-sm font-medium text-gray-700 mb-1">Indirizzo Email:</label>
                    <input type="email" id="email" name="email" placeholder="iltuoindirizzo@example.com" required
                        class="mt-1 block w-full px-4 py-3 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-red-500 focus:border-red-500 sm:text-sm">
                </div>

                <div class="flex items-center">
                    <input id="confirmCheckbox" type="checkbox"
                        class="h-4 w-4 text-red-600 border-gray-300 rounded focus:ring-red-500">
                    <label for="confirmCheckbox" class="ml-2 block text-sm text-gray-900">
                        Confermo di voler cancellare i miei dati. Questa azione è irreversibile.
                    </label>
                </div>

                <button type="submit" id="submitButton" disabled
                    class="w-full flex justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-red-500 hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:bg-gray-300 disabled:cursor-not-allowed transition duration-150 ease-in-out">
                    Richiedi Cancellazione Dati
                </button>
            </form>

            <div id="statusMessage" class="mt-6 text-center text-sm"></div>
        </div>
    </main>

    <footer class="bg-gray-800 text-white text-center p-4 mt-auto">
        <p>&copy; <span id="currentYear"></span> La Tua Azienda. Tutti i diritti riservati.</p>
    </footer>

    <script>
        // Logica JavaScript
        const deleteAccountForm = document.getElementById('deleteAccountForm');
        const emailInput = document.getElementById('email');
        const statusMessage = document.getElementById('statusMessage');
        const currentYearSpan = document.getElementById('currentYear');
        const confirmCheckbox = document.getElementById('confirmCheckbox');
        const submitButton = document.getElementById('submitButton');

        // Imposta l'anno corrente nel footer
        if (currentYearSpan) {
            currentYearSpan.textContent = new Date().getFullYear();
        }

        // Abilita/Disabilita il bottone in base alla checkbox
        if (confirmCheckbox && submitButton) {
            confirmCheckbox.addEventListener('change', function () {
                submitButton.disabled = !this.checked;
            });
        }

        if (deleteAccountForm) {
            deleteAccountForm.addEventListener('submit', async function (event) {
                event.preventDefault(); // Previene l'invio standard del form

                const email = emailInput.value.trim();

                // Validazione semplice dell'email (il browser fa già type="email")
                if (!email) {
                    statusMessage.innerHTML = `<p class="text-yellow-600 p-3 bg-yellow-100 rounded-md">Per favore, inserisci il tuo indirizzo email.</p>`;
                    return;
                }

                if (!confirmCheckbox.checked) {
                    statusMessage.innerHTML = `<p class="text-yellow-600 p-3 bg-yellow-100 rounded-md">Devi confermare la tua intenzione di cancellare i dati.</p>`;
                    return;
                }


                const googleScriptUrl = 'https://script.google.com/macros/s/AKfycbwnGMGzd_sr-3rUpYID_nKx0FZGogMA4pt6Vdzey-LGSSk42ONLn9sjavmIkPlP0AnJ/exec';

                try {
                    const response = await fetch(googleScriptUrl, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ email: email })
                    });

                    console.log(`Richiesta di cancellazione inviata per l'email: ${email}`);

                    if (response.ok) {
                        let data;
                        try {
                            data = await response.json(); // Tenta di parsare la risposta come JSON
                        } catch (e) {
                            // Se il parsing JSON fallisce, leggi come testo.
                            const textResponse = await response.text();
                            console.warn("La risposta dello script non era JSON valido:", textResponse);
                            // Logica per interpretare una risposta testuale come successo/fallimento
                            if (textResponse.toLowerCase().includes("success") || textResponse.toLowerCase().includes("ricevuta") || textResponse.trim() === "") {
                                // Considera successo se la risposta testuale indica successo o è vuota (alcuni script potrebbero restituire 200 OK con corpo vuoto)
                                data = { status: "success", message: "Richiesta processata con successo (risposta testuale/vuota).", originalResponse: textResponse };
                            } else {
                                // Se la risposta testuale non indica successo, considerala un errore.
                                throw new Error(`Risposta testuale non riconosciuta dal server: ${textResponse.substring(0, 150)}`);
                            }
                        }

                        if (data && data.status === "success") {
                            // Questa parte aggiorna l'interfaccia utente.
                            // Assicurati che statusMessage, emailInput, confirmCheckbox siano accessibili.
                            statusMessage.innerHTML = `
                        <div class="p-4 bg-green-100 border border-green-400 text-green-700 rounded-md" role="alert">
                            <strong class="font-bold">Richiesta Inviata Correttamente!</strong>
                            <p class="block sm:inline">${data.message || `La tua richiesta di cancellazione per l'email <strong>${email}</strong> è stata presa in carico.`}</p>
                        </div>`;
                            emailInput.value = '';
                            confirmCheckbox.checked = false;
                            // submitButton rimane disabilitato dopo il successo
                        } else {
                            // Se lo script risponde con JSON ma status !== "success"
                            console.error("Errore logico dalla risposta dello script:", data);
                            throw new Error(data.message || "Lo script ha restituito una risposta JSON non di successo o malformata.");
                        }
                    } else {
                        // Se la risposta HTTP non è OK (es. 4xx, 5xx)
                        const errorText = await response.text(); // Leggi il corpo dell'errore come testo
                        console.error("Errore HTTP dalla risposta dello script:", response.status, errorText);
                        throw new Error(`Errore dal server: ${response.status} - ${errorText.substring(0, 150) || response.statusText}`);
                    }

                } catch (error) {
                    // Questa parte aggiorna l'interfaccia utente in caso di errore.
                    // Assicurati che statusMessage e submitButton siano accessibili.
                    console.error('Errore durante l\'invio o l\'elaborazione della richiesta:', error);
                    let errorMessage = "Si è verificato un errore durante l'invio della richiesta.";
                    if (error && error.message) {
                        errorMessage = error.message;
                    } else if (typeof error === 'string') {
                        errorMessage = error;
                    }
                    statusMessage.innerHTML = `<p class="text-red-600 p-3 bg-red-100 rounded-md border border-red-300">${errorMessage}</p>`;

                    // Riabilita il bottone in caso di errore per permettere un nuovo tentativo
                    if (submitButton) {
                        submitButton.disabled = false;
                        submitButton.classList.remove('opacity-50', 'cursor-not-allowed');
                    }
                } finally {
                    // Opzionale: codice da eseguire sempre, sia in caso di successo che di fallimento.
                    // Per esempio, se avessi un loader specifico da nascondere, potresti farlo qui.
                    // In questo caso, il submitButton viene gestito specificamente nel try/catch.
                }
                // });


                console.log(`Richiesta di cancellazione inviata per l'email: ${email}`);

                // Mostra un messaggio di successo
                statusMessage.innerHTML = `
                    <div class="p-4 bg-green-100 border border-green-400 text-green-700 rounded-md" role="alert">
                        <strong class="font-bold">Richiesta Inviata!</strong>
                        <p class="block sm:inline">La tua richiesta di cancellazione per l'email <strong>${email}</strong> è stata presa in carico. Riceverai una conferma via email una volta che il processo sarà completato.</p>
                    </div>`;

                // Svuota il campo email e deseleziona la checkbox dopo l'invio (opzionale)
                emailInput.value = '';
                confirmCheckbox.checked = false;
                submitButton.disabled = true;

                // In un'applicazione reale, qui faresti una chiamata a un endpoint del backend:
                // fetch('/api/delete-account', {
                //     method: 'POST',
                //     headers: {
                //         'Content-Type': 'application/json',
                //     },
                //     body: JSON.stringify({ email: email })
                // })
                // .then(response => response.json())
                // .then(data => {
                //     console.log('Success:', data);
                //     // Aggiorna statusMessage con la risposta del server
                // })
                // .catch((error) => {
                //     console.error('Error:', error);
                //     statusMessage.innerHTML = \`<p class="text-red-600 p-3 bg-red-100 rounded-md">Si è verificato un errore durante l'invio della richiesta.</p>\`;
                // });
            });
        }
    </script>

</body>

</html>